(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{2022:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(1423)}])},1423:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>eo});var a=n(4848),s=n(3368),i=n.n(s),r=n(6540),l=n(3552),o=n(1501),d=n(9596),c=n(130),u=n(2413),h=n(2064),g=n(9219),x=n(2915),p=n(1917),m=n(1395);let f=(0,l.Ay)(o.A)(e=>{let{theme:t}=e;return{display:"flex",flexDirection:"column",alignSelf:"center",width:"100%",padding:t.spacing(2),gap:t.spacing(1),margin:"auto",maxWidth:"350px",[t.breakpoints.up("sm")]:{maxWidth:"350px"},boxShadow:"hsla(220, 30%, 5%, 0.05) 0px 5px 5px 0px, hsla(220, 25%, 10%, 0.05) 0px 15px 35px -5px",...t.applyStyles("dark",{boxShadow:"hsla(220, 30%, 5%, 0.5) 0px 5px 5px 0px, hsla(220, 25%, 10%, 0.08) 0px 15px 35px -5px"})}}),j=(0,l.Ay)(d.A)(e=>{let{theme:t}=e;return{minHeight:"600px",padding:t.spacing(1),[t.breakpoints.up("sm")]:{padding:t.spacing(1)},"&::before":{content:'""',display:"block",position:"absolute",zIndex:-1,inset:0,backgroundImage:"radial-gradient(ellipse at 50% 50%, hsl(181.5,100%,32%), hsl(181.5,30%,32%))",backgroundRepeat:"no-repeat",...t.applyStyles("dark",{backgroundImage:"radial-gradient(at 50% 50%, hsla(210, 100%, 16%, 0.5), hsl(220, 30%, 5%))"})}}}),w=e=>{let{handleLogin:t}=e,[n,s]=r.useState(!1),[i,l]=r.useState(!1),[o,d]=r.useState(""),[w,A]=r.useState(""),v=async e=>{e.preventDefault();let n=new FormData(e.currentTarget);"admin"==n.get("username").toString()&&"vonat123"==n.get("password").toString()?t(n.get("username").toString(),n.get("password").toString()):(s(!0),l(!0))};return(0,a.jsx)(j,{direction:"column",justifyContent:"space-between",children:(0,a.jsxs)(f,{variant:"outlined",sx:{backgroundColor:"#FFFFFF"},children:[(0,a.jsxs)(h.A,{sx:{display:"flex",flexGrow:2,justifyContent:"center",alignItems:"center",backgroundColor:"#009fa3",borderRadius:1},children:[(0,a.jsx)(m.A,{component:"img",style:{width:90,marginRight:10,filter:"invert(1)"},image:"/images/MAV.svg",alt:"M\xc1VSZK"}),(0,a.jsx)(m.A,{component:"img",style:{width:200,marginRight:10,color:"black"},image:"/images/ik-logo-nagy.svg",alt:"ELTE IK"})]}),(0,a.jsx)(u.A,{component:"div",variant:"h5",sx:{width:"100%",color:"#555555"},children:"Vonat k\xe9s\xe9s előrejelző"}),(0,a.jsxs)(h.A,{component:"form",onSubmit:v,noValidate:!0,sx:{display:"flex",flexDirection:"column",width:"100%",gap:2},children:[(0,a.jsxs)(g.A,{children:[(0,a.jsx)(x.A,{htmlFor:"username",children:"Felhaszn\xe1l\xf3n\xe9v"}),(0,a.jsx)(c.A,{error:n,id:"username",type:"username",name:"username",placeholder:"felhaszn\xe1l\xf3n\xe9v",autoComplete:"username",autoFocus:!0,required:!0,fullWidth:!0,variant:"outlined",color:n?"error":"primary"})]}),(0,a.jsxs)(g.A,{children:[(0,a.jsx)(x.A,{htmlFor:"password",children:"Jelsz\xf3"}),(0,a.jsx)(c.A,{error:i,name:"password",placeholder:"••••••",type:"password",id:"password",autoComplete:"current-password",autoFocus:!0,required:!0,fullWidth:!0,variant:"outlined",color:i?"error":"primary"})]}),(0,a.jsx)(p.A,{type:"submit",fullWidth:!0,variant:"contained",onClick:()=>{let e=document.getElementById("username"),t=document.getElementById("password");return e.value&&0!=e.value.length?(s(!1),d("")):(s(!0),d("Felhaszn\xe1l\xf3n\xe9v nem lehet \xfcres")),t.value&&0!=t.value.length?(l(!1),A("")):(l(!0),A("Jelsz\xf3 nem lehet \xfcres")),!0},children:"Bejelentkez\xe9s"})]})]})})};var A=n(9713),v=n(4551),y=n(2424),b=n(1223),S=n(1059),k=n(6733),I=n(1795),z=n(9406),C=n(8694),T=n(373),E=n(1952),F=n(4294),D=n(1217),R=n(6717),_=n(103),V=n(6800),L=n(9276);n(9300);var N=n(2689),M=n(44),K=n(1771),U=n(7568),H=n(8036),B=n(258),W=n(9990);let P=e=>{let{vonatszam:t,details:n,name:s,type:i,date:l}=e,[d,c]=(0,r.useState)();return((0,r.useEffect)(()=>{c(n)}),d)?(0,a.jsx)(o.A,{sx:{backgroundColor:"rgba(255, 255, 255, 0.8)"},children:(0,a.jsxs)(N.A,{children:[(0,a.jsxs)(u.A,{variant:"h6",component:"div",gutterBottom:!0,sx:{display:"flex",width:"100%",justifyContent:"center",alignItems:"center"},children:[t," ",i," ",s]}),(0,a.jsx)(u.A,{sx:{display:"flex",width:"100%",justifyContent:"center",alignItems:"center"},children:l}),(0,a.jsx)(M.A,{sx:{height:"calc(100vh - 230px)",overflow:"auto",margin:2},children:(0,a.jsxs)(K.A,{children:[(0,a.jsx)(U.A,{children:(0,a.jsxs)(H.A,{children:[(0,a.jsx)(B.A,{children:"Km"}),(0,a.jsx)(B.A,{children:"\xc1llom\xe1s"}),(0,a.jsx)(B.A,{children:"\xc9rkez\xe9s"}),(0,a.jsx)(B.A,{children:"Indul\xe1s"})]})}),(0,a.jsx)(W.A,{children:d.map((e,t)=>(0,a.jsxs)(H.A,{children:[(0,a.jsx)(B.A,{padding:"none",children:e.Km}),(0,a.jsx)(B.A,{padding:"none",children:e.Állomás}),(0,a.jsxs)(B.A,{padding:"none",children:[(0,a.jsx)(u.A,{sx:{display:"flex",width:"100%",justifyContent:"center",alignItems:"center",color:"#3287a8",fontSize:12},children:e.ERK_TERV}),(0,a.jsx)(u.A,{sx:{display:"flex",width:"100%",justifyContent:"center",alignItems:"center",color:"#a84632",fontSize:12},children:e.ERK_TENY}),(0,a.jsx)(u.A,{sx:{display:"flex",width:"100%",justifyContent:"center",alignItems:"center",color:"#a83292",fontSize:12},children:e.Utolso_erk_pred})]}),(0,a.jsxs)(B.A,{padding:"none",children:[" ",(0,a.jsx)(u.A,{sx:{display:"flex",width:"100%",justifyContent:"center",alignItems:"center",color:"#3287a8",fontSize:12},children:e.IND_TERV}),(0,a.jsx)(u.A,{sx:{display:"flex",width:"100%",justifyContent:"center",alignItems:"center",color:"#a84632",fontSize:12},children:e.IND_TENY}),(0,a.jsx)(u.A,{sx:{display:"flex",width:"100%",justifyContent:"center",alignItems:"center",color:"#a83292",fontSize:12},children:e.Utolso_ind_pred})]})]},t))})]})})]})}):""};var Y=n(5737),Z=n(7474),G=n(8031),O=n(3707),q=n(953),J=n(4562),X=n(2449),$=n(5668);let Q=e=>{let t=10>e.getUTCDate()?"0"+e.getUTCDate():e.getUTCDate(),n=9>e.getUTCMonth()?"0"+(e.getUTCMonth()+1):e.getUTCMonth()+1;return e.getFullYear()+"-"+n+"-"+t};var ee=n(7733),et=n(3628);let en=e=>{let{config:t,historyMode:n}=e,s=new Date;(0,r.useRef)(null);let[i,l]=(0,r.useState)(),[o,d]=(0,r.useState)(s),[c,g]=(0,r.useState)(60*s.getHours()+s.getMinutes()),[x,p]=(0,r.useState)(),[m,f]=(0,r.useState)(),[j,w]=(0,r.useState)(),[A,v]=(0,r.useState)(""),[y,b]=(0,r.useState)(),[S,k]=(0,r.useState)(""),[N,M]=(0,r.useState)(""),[K,U]=(0,r.useState)(""),[H,B]=(0,r.useState)(new O.A({source:new E.A({attributions:'\xa9 <a href="https://inf.elte.hu.hu">ELTE IK</a>'}),style:new L.Ay({stroke:new q.A({color:"blue",width:4})})})),[W,en]=(0,r.useState)(new O.A({source:new E.A({attributions:'\xa9 <a href="https://mav.hu">M\xc1V Zrt</a>'})})),es=(e,t)=>{e.forEach(e=>{let n=new R.A({geometry:new F.A((0,V.Rb)([e.Lon,e.Lat])),name:e.Nev,vonat:e}),a=new L.Ay({image:new ee.A({radius:6,fill:new et.A({color:ea(e.Keses)}),stroke:new q.A({color:"black",width:1})})});n.setStyle(a),t.addFeature(n)})},ei=()=>{fetch(t.recentTrainsURL).then(e=>e.json()).then(e=>{w(e.trains),v("")}).catch(e=>{console.error("Hiba t\xf6rt\xe9nt a realtime adatok lek\xe9r\xe9se sor\xe1n:",e),v("Hiba t\xf6rt\xe9nt a realtime adatok lek\xe9r\xe9se sor\xe1n")})},er=()=>{o&&fetch(t.historicTrainsURL+"?date="+Q(o)).then(e=>e.json()).then(e=>{p(e.states),v("")}).catch(e=>{console.error("Hiba t\xf6rt\xe9nt a hisztorikus adatok lek\xe9r\xe9se sor\xe1n:",e),v("Hiba t\xf6rt\xe9nt a hisztorikus adatok lek\xe9r\xe9se sor\xe1n")})},el=()=>{n?er():ei()},eo=()=>{let e=new E.A({attributions:'\xa9 <a href="https://mav.hu">M\xc1V Zrt</a>'});es(j,e),W.setSource(e)},ed=(e,t)=>{var n;let a=new D.A(e.map(e=>(0,V.Rb)(e)));H.setStyle(new L.Ay({stroke:new q.A({color:ea(t),width:4})})),null===(n=H.getSource())||void 0===n||n.addFeature(new R.A({geometry:a}))},ec=()=>{var e;null===(e=W.getSource())||void 0===e||e.clear()},eu=()=>{var e;null===(e=H.getSource())||void 0===e||e.clear()},eh=()=>{let e=document.getElementById("popup"),t=(0,V.Rb)([19.040236,47.497913]),n=new I.A({element:e,positioning:"bottom-center",stopEvent:!1,offset:[0,-10],autoPan:{animation:{duration:250}}}),a=new T.A({preload:1/0,source:new _.A({attributions:['\xa9 <a href="https://www.openstreetmap.org/">OpenStreetMap</a>']})}),s=[a,W];H&&s.push(H);let i=new z.A({target:"map",layers:[a,W,H],view:new C.Ay({center:t,zoom:8}),overlays:[n]});i.on("click",e=>{let t=i.forEachFeatureAtPixel(e.pixel,e=>e);t?l(t.get("vonat")):l(void 0)})};(0,r.useEffect)(()=>{eh()}),(0,r.useEffect)(()=>{i?em():eu()},[i]),(0,r.useEffect)(()=>{el()},[n,o]),(0,r.useEffect)(()=>{eg(),ex()},[c,x]);let eg=()=>{if(x&&o&&c){let e=(null==o?void 0:o.getFullYear())+"-"+((null==o?void 0:o.getMonth())+1)+"-"+((null==o?void 0:o.getDate())<=9?"0":"")+(null==o?void 0:o.getDate())+" "+ef(c);for(let t=0;t<x.length;t++)if(x[t].Timestamp.substring(0,16)<=e&&x[t].Valid.substring(0,16)>=e){w(x[t].trains),v("");return}v("Nem tal\xe1lhat\xf3 adat a k\xe9rt időpontra"),w([])}},ex=()=>{if(i&&o&&c&&m){let e=(null==o?void 0:o.getFullYear())+"-"+((null==o?void 0:o.getMonth())+1)+"-"+((null==o?void 0:o.getDate())<=9?"0":"")+(null==o?void 0:o.getDate())+" "+ef(c);for(let t=0;t<m.length;t++)if(m[t].Timestamp.substring(0,16)<=e&&m[t].Valid.substring(0,16)>=e){ep(m[t]),v("");return}b([])}};(0,r.useEffect)(()=>{ex()},[m]),(0,r.useEffect)(()=>{j?eo():ec()},[j]);let ep=e=>{e.trains&&e.trains[0]&&(k(e.trains[0].Nev),U(e.trains[0].Nap),ed(e.trains[0].geom.coordinates,e.trains[0].Keses),e.trains[0].Table&&(b(e.trains[0].Table),e.trains[0].Table[0]&&M(e.trains[0].Table[0].TiPUS)))},em=()=>{o&&fetch((n?t.historicDetailsURL+"?date="+Q(o)+"&":t.recentDetailsURL+"?")+"Vonatszam="+(null==i?void 0:i.Vonatszam)).then(e=>e.json()).then(e=>{e.states?f(e.states):ep(e)})},ef=e=>{let t=Math.trunc(e/60),n=e-60*t;return"".concat(t<=9?"0":"").concat(t,":").concat(n<=9?"0":"").concat(n)},ej=e=>e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{height:"1000px",width:"100%"},id:"map",className:"map-container"}),(0,a.jsx)("div",{id:"popup",className:"ol-popup",style:{backgroundColor:"#fff"},children:(0,a.jsx)("div",{id:"popup-content"})}),i&&y?(0,a.jsx)("div",{style:{position:"fixed",top:"70px",right:"7px",zIndex:1e3},children:(0,a.jsx)(P,{vonatszam:null==i?void 0:i.Vonatszam,details:y,name:S,type:N,date:K})}):"",n?(0,a.jsx)("div",{style:{position:"fixed",top:"72px",left:"90px",zIndex:1e3,backgroundColor:"rgba(255, 255, 255, 0.8)"},children:(0,a.jsxs)(h.A,{sx:{width:250,padding:1},children:[(0,a.jsx)(Y.$,{dateAdapter:Z.h,adapterLocale:J.A,children:(0,a.jsx)(G.l,{label:"D\xe1tum",value:o,sx:{padding:0},onChange:e=>{d(e)}})}),(0,a.jsxs)(u.A,{id:"non-linear-slider",sx:{fontSize:12},gutterBottom:!0,children:["Időpont: ",ef(ej(c))]}),(0,a.jsx)(X.Ay,{value:c,min:0,step:10,max:1440,scale:ej,getAriaValueText:ef,valueLabelFormat:ef,onChange:(e,t,n)=>{"number"==typeof t&&g(t)},valueLabelDisplay:"auto","aria-labelledby":"non-linear-slider"})]})}):"",A?(0,a.jsx)("div",{style:{position:"fixed",top:"100px",left:"50%",zIndex:1e3,backgroundColor:"rgba(255, 255, 255, 0.8)"},children:(0,a.jsx)($.A,{severity:"error",children:A})}):""]})};function ea(e){return e<0?"blue":e<=5?"green":e<=15?"yellow":e<=30?"orange":"red"}function es(){let[e,t]=(0,r.useState)(),[n,s]=(0,r.useState)(),[i,l]=(0,r.useState)(),[o,d]=(0,r.useState)(!1),[c,g]=(0,r.useState)(!1),[x,p]=(0,r.useState)();async function f(e,n){t(e),s(n),l(new Date().getTime()),window.localStorage.setItem("username",e),window.localStorage.setItem("password",n),window.localStorage.setItem("loginTimestamp",new Date().getTime().toString())}if((0,r.useEffect)(()=>{fetch("/config.json").then(e=>e.json()).then(e=>p(e));let a=window.localStorage.getItem("username"),r=window.localStorage.getItem("password"),o=window.localStorage.getItem("loginTimestamp");!e&&a&&a!=e&&t(a),!n&&r&&r!=n&&s(r),!i&&o&&Number.parseInt(o)!=i&&l(Number.parseInt(o))},[]),(0,r.useEffect)(()=>{let t=new Date;x&&e&&n&&i&&i+x.logoutLimit>=t.getTime()||(x&&e&&n&&i?(console.log("lej\xe1rt session"),console.log(i+x.logoutLimit),console.log(t.getTime())):console.log("hi\xe1nyz\xf3 config vagy fh adatok"))},[x]),!x)return(0,a.jsx)("div",{children:"Loading configuration..."});var j=new Date;return!e||!n||!i||i+x.logoutLimit<j.getTime()?(0,a.jsx)(w,{handleLogin:f}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.A,{sx:{flexGrow:1,backgroundColor:"#fbfbfb"},children:(0,a.jsx)(A.A,{position:"static",children:(0,a.jsxs)(v.A,{children:[(0,a.jsx)(y.A,{size:"large",edge:"start",color:"inherit","aria-label":"menu",sx:{mr:2},children:(0,a.jsx)(b.A,{})}),(0,a.jsx)(u.A,{variant:"h5",component:"div",sx:{width:"300px"},children:"Vonat K\xe9s\xe9s Előrejelző"}),(0,a.jsxs)(h.A,{sx:{display:"flex",flexGrow:2,justifyContent:"center",alignItems:"center"},children:[(0,a.jsx)(m.A,{component:"img",style:{width:60,marginRight:10,filter:"invert(1)"},image:"/images/MAV.svg",alt:"M\xc1VSZK"}),(0,a.jsx)(m.A,{component:"img",style:{width:150,marginRight:10},image:"/images/ik-logo-nagy.svg",alt:"ELTE IK"})]}),(0,a.jsx)(y.A,{size:"large",edge:"end",color:"inherit","aria-description":"Historikus n\xe9zet",onClick:function(){window.localStorage.setItem("username",""),window.localStorage.setItem("password",""),t(""),s("")},sx:{paddingRight:0},children:(0,a.jsx)(S.A,{})})]})})}),(0,a.jsx)("div",{style:{height:"calc(100vh - 64px)",width:"100%",overflow:"hidden"},children:(0,a.jsx)(en,{config:x,historyMode:c})}),(0,a.jsx)("div",{style:{position:"fixed",top:"71px",left:"40px",zIndex:1e3,height:"47px",borderRadius:"4px",borderWidth:"thin",borderColor:"#ccc7c7",borderStyle:"solid",margin:"1px",backgroundColor:"rgba(255, 255, 255, 0.8)"},children:(0,a.jsx)(y.A,{size:"large",color:"inherit",onClick:function(){g(!c),console.log("hisztorikus adatok megjelen\xedt\xe9se")},sx:{padding:1,color:c?"red":"inherit"},children:(0,a.jsx)(k.A,{})})})]})}var ei=n(2026),er=n(7371);let el=(0,ei.A)({palette:{primary:{light:"#2dccd0",main:"#009fa3",dark:"#0d7375",contrastText:"#fff"},secondary:{light:"#ff7961",main:"#f44336",dark:"#ba000d",contrastText:"#000"}}});function eo(){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(i(),{children:[(0,a.jsx)("title",{children:"VKE"}),(0,a.jsx)("meta",{name:"description",content:"Vonat k\xe9s\xe9s előrejelző"}),(0,a.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,a.jsx)(er.A,{theme:el,children:(0,a.jsx)(es,{})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[842,636,593,792],()=>t(2022)),_N_E=e.O()}]);